[mysqld]
# ===========================================
# T16O Optimized MySQL Configuration
# Optimized for forward-write design with cacheable data
# ===========================================


# --- DISABLE BINARY LOGGING ---
# Binary log is only needed for replication/point-in-time recovery
# For cacheable blockchain data, this is unnecessary overhead
skip-log-bin

# --- TRANSACTION LOGGING (MAJOR PERFORMANCE GAINS) ---
# Value 2: Flush log buffer to OS every second, not every commit
# Risk: Up to 1 second of data loss on OS crash (acceptable for cacheable data)
innodb_flush_log_at_trx_commit = 2

# --- BUFFER POOL (MEMORY) ---
# Larger buffer pool = more data cached in memory = fewer disk reads
# Adjust based on available RAM (2GB configured via command args)
innodb_buffer_pool_size = 2G

# --- LOG BUFFER ---
# Larger log buffer for batch writes before flushing
innodb_log_buffer_size = 256M

# --- REDO LOG CAPACITY ---
# Larger redo log = fewer checkpoints = better write performance
# MySQL 8.0.30+ uses innodb_redo_log_capacity instead of innodb_log_file_size
innodb_redo_log_capacity = 2G

# --- I/O CAPACITY ---
# Optimized for SSDs and fast storage
innodb_io_capacity = 8000
innodb_io_capacity_max = 16000

# --- FLUSH METHOD ---
# O_DIRECT bypasses OS cache (recommended for dedicated DB servers)
# Comment out if experiencing issues on Windows/Docker
# innodb_flush_method = O_DIRECT

# --- DOUBLEWRITE BUFFER ---
# Can be disabled on systems with battery-backed write cache
# Provides crash protection but adds write overhead
# innodb_doublewrite = OFF

# --- CONCURRENT INSERTS ---
# Allow concurrent inserts even when table has gaps
concurrent_insert = 2

# --- CONNECTION HANDLING ---
max_connections = 200
thread_cache_size = 16

# --- QUERY CACHE (disabled in MySQL 8.0+) ---
# MySQL 8.0 removed query cache, so no settings needed

# --- TABLE OPEN CACHE ---
table_open_cache = 4000
table_definition_cache = 2000

# --- TEMP TABLES ---
tmp_table_size = 512M
max_heap_table_size = 512M

# --- SORT/JOIN BUFFERS ---
sort_buffer_size = 4M
join_buffer_size = 4M
read_buffer_size = 2M
read_rnd_buffer_size = 4M

# --- INNODB SETTINGS ---
innodb_file_per_table = ON
innodb_stats_on_metadata = OFF
innodb_buffer_pool_instances = 1

# --- SLOW QUERY LOG (for debugging - disable in production) ---
slow_query_log = OFF
# slow_query_log_file = /var/lib/mysql/slow.log
# long_query_time = 2
