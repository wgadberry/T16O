-- vw_tx_wash_triangle view
-- Generated from t16o_db instance

DROP VIEW IF EXISTS `vw_tx_wash_triangle`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `vw_tx_wash_triangle` AS select `a1`.`address` AS `wallet_a`,`a2`.`address` AS `wallet_b`,`a3`.`address` AS `wallet_c`,`tk`.`token_symbol` AS `token_symbol`,(`g1`.`amount` / pow(10,`g1`.`decimals`)) AS `leg1_amount`,(`g2`.`amount` / pow(10,`g2`.`decimals`)) AS `leg2_amount`,(`g3`.`amount` / pow(10,`g3`.`decimals`)) AS `leg3_amount`,`g1`.`block_time` AS `leg1_time`,`g3`.`block_time` AS `leg3_time`,(`g3`.`block_time` - `g1`.`block_time`) AS `total_seconds`,`t1`.`signature` AS `tx1`,`t2`.`signature` AS `tx2`,`t3`.`signature` AS `tx3` from (((((((((`tx_guide` `g1` join `tx_guide` `g2` on(((`g1`.`to_address_id` = `g2`.`from_address_id`) and (`g1`.`token_id` = `g2`.`token_id`) and (`g2`.`block_time` >= `g1`.`block_time`) and (`g2`.`block_time` < (`g1`.`block_time` + 7200))))) join `tx_guide` `g3` on(((`g2`.`to_address_id` = `g3`.`from_address_id`) and (`g3`.`to_address_id` = `g1`.`from_address_id`) and (`g2`.`token_id` = `g3`.`token_id`) and (`g3`.`block_time` >= `g2`.`block_time`) and (`g3`.`block_time` < (`g1`.`block_time` + 7200))))) join `tx_address` `a1` on((`g1`.`from_address_id` = `a1`.`id`))) join `tx_address` `a2` on((`g2`.`from_address_id` = `a2`.`id`))) join `tx_address` `a3` on((`g3`.`from_address_id` = `a3`.`id`))) join `tx` `t1` on((`g1`.`tx_id` = `t1`.`id`))) join `tx` `t2` on((`g2`.`tx_id` = `t2`.`id`))) join `tx` `t3` on((`g3`.`tx_id` = `t3`.`id`))) left join `tx_token` `tk` on((`g1`.`token_id` = `tk`.`id`))) where (`g1`.`edge_type_id` in (select `tx_guide_type`.`id` from `tx_guide_type` where (`tx_guide_type`.`type_code` in ('spl_transfer','sol_transfer'))) and (`g1`.`from_address_id` <> `g1`.`to_address_id`) and (`g2`.`from_address_id` <> `g2`.`to_address_id`) and (`g3`.`from_address_id` <> `g3`.`to_address_id`));
