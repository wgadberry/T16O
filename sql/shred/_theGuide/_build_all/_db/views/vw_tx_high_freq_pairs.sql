-- vw_tx_high_freq_pairs view
-- Generated from t16o_db instance

DROP VIEW IF EXISTS `vw_tx_high_freq_pairs`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `vw_tx_high_freq_pairs` AS select least(`a1`.`address`,`a2`.`address`) AS `wallet_1`,greatest(`a1`.`address`,`a2`.`address`) AS `wallet_2`,`tk`.`token_symbol` AS `token_symbol`,count(0) AS `transfer_count`,sum((case when (`g`.`from_address_id` = `a1`.`id`) then 1 else 0 end)) AS `wallet1_to_wallet2`,sum((case when (`g`.`from_address_id` = `a2`.`id`) then 1 else 0 end)) AS `wallet2_to_wallet1`,(sum(`g`.`amount`) / pow(10,max(`g`.`decimals`))) AS `total_volume`,min(`g`.`block_time`) AS `first_transfer`,max(`g`.`block_time`) AS `last_transfer`,((max(`g`.`block_time`) - min(`g`.`block_time`)) / 3600) AS `hours_span`,bit_or(CAST(`t`.`tx_state` AS UNSIGNED)) AS `type_state` from ((((`tx_guide` `g` join `tx_address` `a1` on((`g`.`from_address_id` = `a1`.`id`))) join `tx_address` `a2` on((`g`.`to_address_id` = `a2`.`id`))) join `tx` `t` on((`g`.`tx_id` = `t`.`id`))) left join `tx_token` `tk` on((`g`.`token_id` = `tk`.`id`))) where (`g`.`edge_type_id` in (select `tx_guide_type`.`id` from `tx_guide_type` where (`tx_guide_type`.`type_code` in ('spl_transfer','sol_transfer'))) and (`a1`.`id` <> `a2`.`id`)) group by least(`a1`.`address`,`a2`.`address`),greatest(`a1`.`address`,`a2`.`address`),`tk`.`token_symbol` having (count(0) >= 5);
