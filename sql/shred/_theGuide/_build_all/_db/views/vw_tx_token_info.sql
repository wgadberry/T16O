-- vw_tx_token_info view
-- Generated from t16o_db instance

DROP VIEW IF EXISTS `vw_tx_token_info`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `vw_tx_token_info` AS with `token_stats` as (select `g`.`token_id` AS `token_id`,count(0) AS `tx_count`,sum(`g`.`amount`) AS `total_volume`,min(`g`.`block_time`) AS `oldest_block_time`,max(`g`.`block_time`) AS `newest_block_time` from `tx_guide` `g` where (`g`.`token_id` is not null) group by `g`.`token_id`), `oldest_tx` as (select distinct `g`.`token_id` AS `token_id`,first_value(`g`.`tx_id`) OVER (PARTITION BY `g`.`token_id` ORDER BY `g`.`block_time` )  AS `tx_id` from `tx_guide` `g` where (`g`.`token_id` is not null)), `newest_tx` as (select distinct `g`.`token_id` AS `token_id`,first_value(`g`.`tx_id`) OVER (PARTITION BY `g`.`token_id` ORDER BY `g`.`block_time` desc )  AS `tx_id` from `tx_guide` `g` where (`g`.`token_id` is not null)) select `t`.`id` AS `token_id`,`mint`.`address` AS `mint_address`,`t`.`token_symbol` AS `token_symbol`,`t`.`token_name` AS `token_name`,`t`.`decimals` AS `decimals`,`ts`.`tx_count` AS `tx_count`,`ts`.`total_volume` AS `total_volume`,`ot`.`tx_id` AS `oldest_tx_id`,`tx_old`.`signature` AS `oldest_signature`,`tx_old`.`block_id` AS `oldest_block_id`,`tx_old`.`block_time` AS `oldest_block_time`,`tx_old`.`block_time_utc` AS `oldest_block_time_utc`,`nt`.`tx_id` AS `newest_tx_id`,`tx_new`.`signature` AS `newest_signature`,`tx_new`.`block_id` AS `newest_block_id`,`tx_new`.`block_time` AS `newest_block_time`,`tx_new`.`block_time_utc` AS `newest_block_time_utc`,timestampdiff(DAY,`tx_old`.`block_time_utc`,`tx_new`.`block_time_utc`) AS `active_days` from ((((((`tx_token` `t` join `tx_address` `mint` on((`mint`.`id` = `t`.`mint_address_id`))) left join `token_stats` `ts` on((`ts`.`token_id` = `t`.`id`))) left join `oldest_tx` `ot` on((`ot`.`token_id` = `t`.`id`))) left join `newest_tx` `nt` on((`nt`.`token_id` = `t`.`id`))) left join `tx` `tx_old` on((`tx_old`.`id` = `ot`.`tx_id`))) left join `tx` `tx_new` on((`tx_new`.`id` = `nt`.`tx_id`))) order by `ts`.`tx_count` desc;
