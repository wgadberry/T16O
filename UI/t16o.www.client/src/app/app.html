<div class="app-container">
  <!-- Top Bar -->
  <p-toolbar styleClass="top-bar">
    <ng-template #start>
      <div class="logo-section">
        <!-- Mobile menu toggle -->
        <button *ngIf="isMobile"
                class="mobile-menu-btn"
                (click)="toggleMobileDrawer()"
                pRipple>
          <i class="pi pi-bars"></i>
        </button>
        <i class="pi pi-box logo-icon"></i>
        <span class="site-name">{{ title() }}</span>
      </div>
    </ng-template>

    <ng-template #end>
      <div class="user-section">
        <!-- Dark Mode Toggle -->
        <div class="theme-toggle">
          <i class="pi" [ngClass]="darkMode ? 'pi-moon' : 'pi-sun'"></i>
          <p-toggleswitch [(ngModel)]="darkMode" (onChange)="onDarkModeChange()"></p-toggleswitch>
        </div>

        <!-- User Profile -->
        <p-avatar icon="pi pi-user"
                  styleClass="user-avatar"
                  shape="circle"
                  (click)="toggleProfileMenu($event)"
                  pRipple>
        </p-avatar>
        <p-menu #profileMenu [model]="profileMenuItems" [popup]="true"></p-menu>
      </div>
    </ng-template>
  </p-toolbar>

  <div class="app-body">
    <!-- Desktop Sidebar -->
    <aside *ngIf="!isMobile"
           class="sidebar"
           [class.sidebar-visible]="sidebarVisible"
           [class.sidebar-pinned]="sidebarPinned"
           (mouseenter)="onSidebarMouseEnter()"
           (mouseleave)="onSidebarMouseLeave()">

      <!-- Sidebar trigger when collapsed -->
      <div class="sidebar-trigger" *ngIf="!sidebarVisible && !sidebarPinned">
        <i class="pi pi-angle-right"></i>
      </div>

      <!-- Sidebar content -->
      <div class="sidebar-content" *ngIf="sidebarVisible">
        <div class="sidebar-header">
          <span class="sidebar-title">Menu</span>
          <button class="pin-btn"
                  (click)="toggleSidebarPin()"
                  [pTooltip]="sidebarPinned ? 'Unpin menu' : 'Pin menu'"
                  tooltipPosition="right"
                  pRipple>
            <i class="pi" [ngClass]="sidebarPinned ? 'pi-lock' : 'pi-lock-open'"></i>
          </button>
        </div>

        <nav class="sidebar-nav">
          <a *ngFor="let item of sidebarMenuItems"
             class="sidebar-item"
             (click)="onMenuItemClick(item)"
             pRipple>
            <i [class]="item.icon"></i>
            <span class="sidebar-item-label">{{ item.label }}</span>
          </a>
        </nav>
      </div>
    </aside>

    <!-- Mobile Drawer -->
    <p-drawer *ngIf="isMobile"
              [(visible)]="mobileDrawerVisible"
              [modal]="true"
              [showCloseIcon]="true"
              header="Menu"
              position="left"
              styleClass="mobile-drawer">
      <nav class="sidebar-nav">
        <a *ngFor="let item of sidebarMenuItems"
           class="sidebar-item"
           (click)="onMenuItemClick(item)"
           pRipple>
          <i [class]="item.icon"></i>
          <span class="sidebar-item-label">{{ item.label }}</span>
        </a>
      </nav>
    </p-drawer>

    <!-- Main Content -->
    <main class="main-content" [class.with-sidebar]="sidebarVisible && sidebarPinned && !isMobile">
      <p-card>
        <ng-template #header>
          <div style="padding: 1rem 1.5rem 0;">
            <h2 style="margin: 0;"><i class="pi pi-cloud" style="margin-right: 0.5rem;"></i>Weather Forecast</h2>
            <p style="margin: 0.5rem 0 0; color: var(--text-color-secondary);">5-day weather forecast from the server</p>
          </div>
        </ng-template>

        <p *ngIf="forecasts.length === 0">
          <i class="pi pi-spin pi-spinner" style="margin-right: 0.5rem;"></i>
          Loading... Please refresh once the ASP.NET backend has started.
        </p>

        <p-table [value]="forecasts" *ngIf="forecasts.length > 0"
                 [tableStyle]="{'min-width': '50rem'}"
                 styleClass="p-datatable-striped"
                 [paginator]="false">
          <ng-template #header>
            <tr>
              <th>Date</th>
              <th>Temperature (C)</th>
              <th>Temperature (F)</th>
              <th>Summary</th>
            </tr>
          </ng-template>
          <ng-template #body let-forecast>
            <tr>
              <td><i class="pi pi-calendar" style="margin-right: 0.5rem;"></i>{{ forecast.date }}</td>
              <td>{{ forecast.temperatureC }}°C</td>
              <td>{{ forecast.temperatureF }}°F</td>
              <td>
                <p-tag [value]="forecast.summary" [severity]="getTemperatureSeverity(forecast.temperatureC)"></p-tag>
              </td>
            </tr>
          </ng-template>
        </p-table>

        <ng-template #footer>
          <div style="display: flex; justify-content: flex-end;">
            <p-button label="Refresh" icon="pi pi-refresh" (click)="getForecasts()"></p-button>
          </div>
        </ng-template>
      </p-card>
    </main>
  </div>
</div>
